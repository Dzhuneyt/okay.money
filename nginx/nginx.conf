http {
    upstream backend{
        # Uses AWS Service Discovery
        server ${BACKEND_HOST};
    }
    upstream frontend{
        # Uses AWS Service Discovery
        server ${FRONTEND_HOST};
    }

    server {
        server_name _;

        location /health {
          return 200 "healthy\n";
        }

        # Frontend
        location / {
          proxy_pass http://frontend;
        }

        location /v1 {
          proxy_pass http://backend;
          rewrite ^/(.*)$ /$1 break;
        }
    }

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    ##
    # Gzip Settings
    ##

    gzip on;
    gzip_disable "msie6";

    # gzip_vary on;
    # gzip_proxied any;
    # gzip_comp_level 6;
    # gzip_buffers 16 8k;
    # gzip_http_version 1.1;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;


}
events{
        worker_connections 768;
}
